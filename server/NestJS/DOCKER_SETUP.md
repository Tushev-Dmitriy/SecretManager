# ๐ Docker Deployment Guide

ะะพะปะฝะฐั ัะธััะตะผะฐ SSO ะฐััะตะฝัะธัะธะบะฐัะธะธ ั Keycloak ะธ NestJS ะฒ Docker ะบะพะฝัะตะนะฝะตัะฐั.

## ๐ ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Docker ะธ Docker Compose ัััะฐะฝะพะฒะปะตะฝั
- ะกะฒะพะฑะพะดะฝัะต ะฟะพััั: 3000 (NestJS), 8080 (Keycloak)

## ๐ ะัััััะน ะทะฐะฟััะบ

### 1. ะะฐะฟััะบ ะฒัะตะน ัะธััะตะผั ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน:

```bash
docker-compose up --build
```

### 2. ะะปะธ ะทะฐะฟััะบ ะฒ ัะพะฝะพะฒะพะผ ัะตะถะธะผะต:

```bash
docker-compose up --build -d
```

### 3. ะัะพัะผะพัั ะปะพะณะพะฒ:

```bash
# ะัะต ัะตัะฒะธัั
docker-compose logs -f

# ะขะพะปัะบะพ backend
docker-compose logs -f backend

# ะขะพะปัะบะพ keycloak
docker-compose logs -f keycloak
```

## ๐ง ะะฐัััะพะนะบะฐ Keycloak

ะะพัะปะต ะทะฐะฟััะบะฐ ัะธััะตะผั:

1. **ะัะบัะพะนัะต Keycloak**: http://localhost:8080
2. **ะะพะนะดะธัะต ะบะฐะบ ะฐะดะผะธะฝ**:
   - Username: `admin`
   - Password: `admin_password`

3. **ะกะพะทะดะฐะนัะต realm `corporate-secrets`** (ะตัะปะธ ะฝะต ัััะตััะฒัะตั)

4. **ะกะพะทะดะฐะนัะต client `secrets-app`**:
   - Client type: `OpenID Connect`
   - Client authentication: `ON`
   - Valid redirect URIs: `http://localhost:3000/auth/callback`

5. **ะกะบะพะฟะธััะนัะต Client Secret** ะธ ะพะฑะฝะพะฒะธัะต ะฒ docker-compose.yml

6. **ะกะพะทะดะฐะนัะต ะฟะพะปัะทะพะฒะฐัะตะปั ะดะปั ัะตััะธัะพะฒะฐะฝะธั**

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### 1. ะัะพะฒะตัะบะฐ ััะฐัััะฐ ัะตัะฒะธัะพะฒ:

```bash
curl http://localhost:3000/auth/profile
curl http://localhost:8080/health/ready
```

### 2. ะะฝะธัะธะฐัะธั SSO ะฒัะพะดะฐ:

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต: http://localhost:3000/auth/login

### 3. API ัะตััะธัะพะฒะฐะฝะธะต:

```bash
# ะะพะปััะตะฝะธะต ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั
curl -H "Authorization: Bearer <jwt-token>" \
     http://localhost:3000/auth/profile

# ะะตะบะพะดะธัะพะฒะฐะฝะธะต JWT ัะพะบะตะฝะฐ
curl "http://localhost:3000/auth/decode-token?token=<jwt-token>"
```

## ๐ ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะฝัะตะนะฝะตัะฐะผะธ

### ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะพะฒ:

```bash
docker-compose down
```

### ะััะฐะฝะพะฒะบะฐ ั ัะดะฐะปะตะฝะธะตะผ volumes:

```bash
docker-compose down -v
```

### ะะตัะตะทะฐะฟััะบ ะบะพะฝะบัะตัะฝะพะณะพ ัะตัะฒะธัะฐ:

```bash
docker-compose restart backend
docker-compose restart keycloak
```

### ะะตัะตัะฑะพัะบะฐ ะพะฑัะฐะทะพะฒ:

```bash
docker-compose build --no-cache
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะัะพะฒะตัะบะฐ ััะฐัััะฐ ะบะพะฝัะตะนะฝะตัะพะฒ:

```bash
docker-compose ps
```

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ:

```bash
docker stats
```

### ะะพะดะบะปััะตะฝะธะต ะบ ะบะพะฝัะตะนะฝะตัั:

```bash
# Backend
docker-compose exec backend sh

# Keycloak
docker-compose exec keycloak bash
```

## ๐ Troubleshooting

### ะัะพะฑะปะตะผั ั ะฟะพััะฐะผะธ:

```bash
# ะัะพะฒะตัะบะฐ ะทะฐะฝัััั ะฟะพััะพะฒ
netstat -tulpn | grep :3000
netstat -tulpn | grep :8080
```

### ะัะพะฑะปะตะผั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั:

```bash
# ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ Supabase
docker-compose exec backend npx prisma db pull
```

### ะัะพะฑะปะตะผั ั Keycloak:

```bash
# ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ Keycloak
docker-compose logs keycloak | tail -50
```

### ะัะธััะบะฐ Docker:

```bash
# ะฃะดะฐะปะตะฝะธะต ะฝะตะธัะฟะพะปัะทัะตะผัั ะพะฑัะฐะทะพะฒ
docker system prune -a

# ะฃะดะฐะปะตะฝะธะต ะฒัะตั volumes
docker volume prune
```

## ๐ง ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะัะต ะฟะตัะตะผะตะฝะฝัะต ะฝะฐัััะพะตะฝั ะฒ docker-compose.yml:

- `DATABASE_URL` - ะฟะพะดะบะปััะตะฝะธะต ะบ Supabase
- `KEYCLOAK_*` - ะฝะฐัััะพะนะบะธ ะธะฝัะตะณัะฐัะธะธ ั Keycloak
- `JWT_SECRET` - ัะตะบัะตั ะดะปั ะฟะพะดะฟะธัะธ JWT ัะพะบะตะฝะพะฒ
- `SESSION_SECRET` - ัะตะบัะตั ะดะปั ัะตััะธะน

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Web Browser   โโโโโโ   NestJS API    โโโโโโ   Supabase DB   โ
โ   (Client)      โ    โ   (Port 3000)   โ    โ   (External)    โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                       โ
         โ              โโโโโโโโโโโโโโโโโโโ
         โโโโโโโโโโโโโโโโ    Keycloak     โ
                        โ   (Port 8080)   โ
                        โโโโโโโโโโโโโโโโโโโ
```

## ๐ ะงัะพ ะดะฐะปััะต?

- ะะฐัััะพะนัะต CI/CD ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั
- ะะพะฑะฐะฒััะต ะผะพะฝะธัะพัะธะฝะณ ั ะฟะพะผะพััั Prometheus/Grafana
- ะะฐัััะพะนัะต SSL ัะตััะธัะธะบะฐัั ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ
- ะกะพะทะดะฐะนัะต ััะพะฝัะตะฝะด ะฟัะธะปะพะถะตะฝะธะต
